---
{"dg-publish":true,"page-title":"k8s kube-scheduler","tags":["云原生/k8s"],"permalink":"/云原生/k8s/kube-scheduler/","dgPassFrontmatter":true}
---


### Kube-Scheduler的调度策略和插件

Kube-Scheduler是Kubernetes集群中负责调度Pod到节点的核心组件。它支持多种调度策略和插件，以满足不同的调度需求和优化集群资源的使用效率。

#### 调度策略

Kube-Scheduler的调度策略主要包括过滤（Filtering）和打分（Scoring）两个步骤。在过滤阶段，调度器会根据预设的断言（Predicates）排除不满足Pod调度需求的节点，形成一个可调度节点列表。在打分阶段，调度器会根据优先级（Priorities）为这些节点打分，并将Pod调度到得分最高的节点上。用户可以通过配置调度策略来调整这些断言和优先级，以实现定制化的调度行为。 

#### 调度插件

Kube-Scheduler的功能通过插件架构实现，这些插件在调度框架的不同扩展点注册并执行任务。常见的调度插件包括但不限于：

-   **QueueSort**：对调度队列中的Pod进行排序。
-   **Filter**：在调度周期中过滤出符合条件的节点。
-   **Score**：在绑定周期中为节点打分。
-   **Bind**：将调度决策应用到集群中的节点上。
-   **Reserve**：预留资源以供后续调度使用。
-   **Permit**：控制调度器的行为，如重试策略等。

用户可以通过配置调度配置（Scheduling Profiles）来启用或禁用这些插件，以适应不同的调度场景。 

#### 自定义调度策略

Kube-Scheduler支持自定义调度策略，用户可以通过编写自己的调度器或使用第三方调度器插件来扩展默认的调度功能。此外，用户还可以通过给节点和Pod设置标签，以及使用亲和性和容忍度策略来进一步控制调度行为。 

综上所述，Kube-Scheduler提供了灵活的调度策略和插件体系，以支持复杂的调度需求和优化集群资源的有效利用。通过配置和扩展这些策略和插件，用户可以根据具体的应用场景和性能要求来调整调度行为。

#### 自定义kube-scheduler配置的步骤

要自定义Kubernetes的kube-scheduler以适应特定的工作负载需求，您可以按照以下步骤操作：

1.  **定义调度策略**：您需要确定自定义调度器的策略和规则，这些规则将指导调度器决定如何为Pod分配节点。考虑的策略可能包括节点的资源利用率、Pod之间的亲和性和反亲和性规则、以及对高可用和高性能要求的优先级设置。 
    
2.  **配置和部署调度器**：完成调度策略的定义后，下一步是配置和部署自定义调度器到Kubernetes集群中。这一过程通常需要编写配置文件来指定调度器的行为，并将调度器作为集群中的一个服务部署运行。部署自定义调度器涉及创建容器镜像、编写部署配置文件等步骤。 
    
3.  **在Pod中使用自定义调度器**：要让Pod使用自定义调度器，需要在Pod的配置文件中明确指定。这意味着您可以在同一集群中同时使用默认调度器和一个或多个自定义调度器，为不同类型的应用和负载提供最优的资源分配和调度策略。 
    
4.  **指定自定义调度器**：在Pod的配置文件中，通过设置`spec.schedulerName`字段为自定义调度器的名称，可以指定该Pod应该由哪个调度器进行调度。 
    
5.  **使用调度器扩展点**：您可以通过实现调度器扩展点（Extender）来扩展kube-scheduler的功能，定义自己的调度算法和策略，并在kube-scheduler的调度过程中进行调用。这为用户提供了更大的灵活性，可以根据实际需求定制调度行为。 
    
6.  **编辑kube-scheduler配置文件**：您可以通过`--config`参数指定调度器将使用哪些参数，该配置文件应该包含一个`KubeSchedulerConfiguration`对象，其中可以指定算法源（`algorithmSource`）和调度策略文件路径（`policy`）。\[9\] 
    

通过以上步骤，您可以根据特定的工作负载需求调整kube-scheduler的行为，以优化集群资源的使用和应用性能。